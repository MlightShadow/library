# 现代操作系统快速笔记

操作系统的学习离不开对于操作系统发展历史的了解， 其发展的历史是解决计算机使用中遇到问题的合集，即现代操作系统的功能合集便是操作系统所需要完成的功能的合集

现代操作系统主要需要完成的任务包含以下内容：
* 硬件适配：当计算机只有一台的时候，程序员只需要对这台计算机进行编程，其硬件也只有当前这台计算机及其配件，但是随着计算机的不断增加，其面临的硬件适配工作就变得繁杂了，为了防止程序员与底层硬件打交道（及其丑陋的硬件api）所以操作系统必须承担封装底层硬件接口的功能。
* 进程管理：早期的计算机通过人工放置纸带的方式加载程序与数据，程序执行完成后通过纸带进行输出，其进程管理完全由人工完成，但是随着计算机执行速度的加快，人工管理进程（即程序的执行）就变得不那么可行了，这必须由操作系统完成。
* 内存管理：既然管理了进程那当然要管理内存，随着进程管理的实现，计算机能够快速运行多道程序，每个进程只能访问自己的内存空间。
* 文件系统：前面提到了纸带加载程序，既然程序不再通过纸带加载，自然需要更好的程序保存方式。

以上简单的提及了，计算机操作系统发展过程中需要解决的需求作为本笔记的引言。

本笔记由快速阅读现代操作系统后编写完成，以下提及《现代操作系统》一书通通以“书上”或者其他方式提示不再过多描述。

其他参考材料：
* 

## 进程管理

> 进程是操作系统中最核心的概念，其他所有的内容都是围绕着进程概念展开的。

在多道程序设计的系统上cpu通常快速的在多个进程间进行切换。再同一时刻一个cpu核心只运行一个进程，这是一种并行的错觉，可以称为伪并行。

### 进程模型

进程中包含执行一个程序所需要的所有资源，包括：
* 相关线程
* 被分配到的内存空间
* 其他运行程序所需要的资源（程序计数器，堆栈指针，打开文件清单，突出的报警，有关进程清单）

#### 创建进程

> 在简单的系统中（例如：微波炉或者其他单片机系统）系统启动时所有进程便都已经存在，但是在较为复杂的通用系统中，进程根据需要进行创建和撤销。

有4种主要事件导致进程的创建：
* 系统初始化。
* 执行了正在运行的进程所调用的进程创建系统调用。
* 用户请求创建一个新进程。
* 一个批处理作业的初始化。

几乎所有的进程都由现已存在的进程执行创建新建进程的系统调用而创建。

* UNIX：使用fork，execve两个系统调用，完成复制当前进程和修改为新进程的进程创建工作；
* Windows：使用Win32函数CreateProcess完成进程的创建和装载；

#### 进程的终止

进程的终止通常由下列条件引起：

* 正常退出（自愿的）：进程的工作完成通过调用exit（UNIX）或者ExitProcess（Windows）进行终止
* 出错退出（自愿的）。
* 严重错误（非自愿）。
* 被其他进程杀死（非自愿）：通常被某个进程调用kill（UNIX）或者TerminateProcess（Windows）杀死。在UNIX和Windows中杀死进程其创建的进程并不会被一并杀死。

#### 进程的层次结构

* UNIX中父进程与其所有的子进程组成一个进程组，整个系统都属于一个根为init的进程树；
* Windows中没有层次的概念，所有进程的地位都是相同的，父进程会有一个可以控制子进程的令牌（句柄），但是可以将令牌送于其他进程；

#### 进程的状态

进程有三种状态：
* 运行态
* 就绪态
* 阻塞态

当进程无法继续运行下去的时候就会被阻塞。
运行和就绪之间由进程调度引起，二者没有本质区别只是就绪态暂时没有分配到cpu时间而已。
当阻塞态等待的外部实际发生时则会转为就绪态，待到cpu空闲并且轮到它运行则会转为运行态。

#### 进程的实现

操作系统维护着一张进程表， 进程由运行态转换到就绪或者阻塞态时需要保存相关信息，以便再次运行时调取。




## 内存管理

### 地址空间

## 文件系统

## 硬件适配

书上提及read 与 write 两个命令来说明硬件接口的丑陋，其每个接口平均都需要13个参数实现相应功能，对程序的编写过程极为不便，通过操作系统对硬件接口的封装，程序编写可以使用更加抽象而简单的方式进行处理硬件操作。

### 启动过程

1. BIOS运行：计算机启动后BIOS最先运行；
2. 硬件检查：BIOS会先检查各类设备是否被安装且是否能够正常响应；
3. 查找启动设备：BIOS通过读取用户事先配置的设备清单寻找相应启动设备，例如U盘，硬盘，软盘等；
4. 操作系统获取配置信息：操作系统再被引导启动后将通过载入设备驱动接过硬件的控制；

### 硬件介绍
